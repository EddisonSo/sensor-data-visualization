<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>ISmart API Documentation</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">Sensor and Data API</li><li class="chapter-item expanded "><a href="models.html"><strong aria-hidden="true">2.</strong> Models</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="sensor_model.html"><strong aria-hidden="true">2.1.</strong> Sensor Model</a></li><li class="chapter-item expanded "><a href="data_model.html"><strong aria-hidden="true">2.2.</strong> Data Model</a></li></ol></li><li class="chapter-item expanded "><a href="repository.html"><strong aria-hidden="true">3.</strong> Repository</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="sensor_repository.html"><strong aria-hidden="true">3.1.</strong> Sensor Repository</a></li><li class="chapter-item expanded "><a href="data_repository.html"><strong aria-hidden="true">3.2.</strong> Data Repository</a></li></ol></li><li class="chapter-item expanded "><a href="routes.html"><strong aria-hidden="true">4.</strong> Routes</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="sensor_api.html"><strong aria-hidden="true">4.1.</strong> Sensor Routes</a></li><li class="chapter-item expanded "><a href="data_api.html"><strong aria-hidden="true">4.2.</strong> Data Routes</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">ISmart API Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<p>The ISmart API provides abstraction to the backend logic to CRUD operations to the API reposible for the data retrieved from the ISmart sensor network.</p>
<p>It utilizes Python for backend logic and PostgreSQL as the database of choice.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="models"><a class="header" href="#models">Models</a></h1>
<p>Models define attributes of the various domain objects for the function of the Ismart API. This includes:</p>
<h2 id="sensor"><a class="header" href="#sensor">Sensor</a></h2>
<p>The Sensor model includes the various attribute related to the sensor device itself.</p>
<h2 id="sensordata"><a class="header" href="#sensordata">SensorData</a></h2>
<p>The SensorData model includes the various attributes related to the data collected by the sensor device.</p>
<h2 id="user"><a class="header" href="#user">User</a></h2>
<p>The User model includes the various attributes related to the authorization of users for accessing the API.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sensor-model"><a class="header" href="#sensor-model">Sensor Model</a></h1>
<p>The Sensor model defines the fields and relationships in the Sensor domain object. This will include the various fields:</p>
<pre><code class="language-python">class Sensor(Base):
   __tablename__ = &quot;sensors&quot;

   id: Mapped[int] = mapped_column(primary_key=True, autoincrement=True)

   creation_time: Mapped[DateTime] = mapped_column(DateTime(timezone=True),
                                                   server_default=func.now())

   address: Mapped[str] = mapped_column(String(128),
                                        nullable=True)

   sensor_data: Mapped[List[&quot;SensorData&quot;]] = relationship(
                                               backref=&quot;sensor&quot;,
                                               cascade=&quot;all, delete-orphan&quot;)

   longitude: Mapped[float] = mapped_column(nullable=True)

   latitude: Mapped[float] = mapped_column(nullable=True)
</code></pre>
<p>The id field uniquely identifies the Sensor object and is used as the primary key for the sensor_table table. This field is generated by PostgreSQL upon the insertion of a new Sensor row. Currently, the uuid4 specification is used for the generation of the UUID field.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sensordata-model"><a class="header" href="#sensordata-model">SensorData Model</a></h1>
<p>The SensorData model defines the fields and relationships in the SensorData domain object. This will include the various fields:</p>
<pre><code class="language-python">class SensorData(Base):
   __tablename__ = &quot;sensor_data&quot;

   id: Mapped[UUID] = mapped_column(UUID(as_uuid=True),
                                    primary_key=True,
                                    default=uuid4)

   sensor_id: Mapped[int] = mapped_column(ForeignKey(&quot;sensors.id&quot;),
                                          nullable=False)
   
   voltage: Mapped[float] = mapped_column(nullable=True)

   rain: Mapped[float] = mapped_column(nullable=True)

   distance: Mapped[int] = mapped_column(nullable=True)

   time: Mapped[DateTime] = mapped_column(DateTime(timezone=True),
                                          server_default=func.now())
</code></pre>
<p>The id field uniquely identifies the SensorData object and is used as the primary key for the sensor_data table. This field is generated by PostgreSQL upon the insertion of a new SensorData row. Currently, the uuid4 specification is used for the generation of the UUID field.</p>
<p>The creation_time field is automatically created during the creation of the SensorData object and is handled by PostgreSQL upon the insertion of a new SensorData row.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="repository"><a class="header" href="#repository">Repository</a></h1>
<p>The repository deisgn pattern is used in order to abstracft CRUD operations from the domain models. This means that CRUD oeprations are done using the methods defined within the various repositories as apposed to defining them within the domain or elsewhere in the application in order to minimize overlapping code and complexity.</p>
<h2 id="sensor-repository"><a class="header" href="#sensor-repository">Sensor Repository</a></h2>
<p>The Sensor repository defines the various CRUD operations on the Sensor domain model.</p>
<h2 id="sensordata-repository"><a class="header" href="#sensordata-repository">SensorData Repository</a></h2>
<p>The SensorData repository defines the various CRUD operations on the SensorData domain model.</p>
<h2 id="user-repository"><a class="header" href="#user-repository">User Repository</a></h2>
<p>The User repository defines the various CRUD operations on the User domain model.</p>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="sensordata-repository-1"><a class="header" href="#sensordata-repository-1">SensorData Repository</a></h1>
<p>The SensorData repository provides a level of abstraction for performing business logic CRUD operations on the SensorData object model. The SensorData repository includes the following methods:</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="routes"><a class="header" href="#routes">Routes</a></h1>
<p>API routes allow services and users to perform CRUD operations via REST protocol. The API exposes two paths:</p>
<h2 id="sensor-api-url"><a class="header" href="#sensor-api-url">Sensor API URL</a></h2>
<pre><code>https://{api-service-url}/sensor_api/
</code></pre>
<p>The Sensor API URL contains all the paths that allow users to perform CRUD operations on the Sensor domain.</p>
<pre><code>https://{api-service-url}/data_api/
</code></pre>
<p>The SensorData API URL contains all the paths that allow users to perform CRUD operations on the SensorData domain.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sensor-api"><a class="header" href="#sensor-api">Sensor API</a></h1>
<p>The Sensor API allows other services and users to access the Sensor data via its many endpoints.</p>
<h2 id="add-sensor-post"><a class="header" href="#add-sensor-post">Add Sensor (POST)</a></h2>
<pre><code>https://{api-service-url}/sensor_api/add_sensor
</code></pre>
<p>/sensor_api/add_sensor allows services and users to add a new sensor to the database to be persisted. It consumes the following fields pass as JSON for authorization and input parameters:</p>
<pre><code class="language-JSON">{
    &quot;api_key&quot;: &quot;string, required for authorization&quot;,
    &quot;address&quot;: &quot;string, optional&quot;,
    &quot;longitude&quot;: &quot;float, optional&quot;,
    &quot;latitude&quot;: &quot;float, optional&quot;
}
</code></pre>
<h2 id="get-sensor-get"><a class="header" href="#get-sensor-get">Get Sensor (GET)</a></h2>
<pre><code>https://{api-service-url}/sensor_api/get_sensor
</code></pre>
<p>/sensor_api/get_sensor allows services and users to add a get sensor metadata. It consumes the following fields pass as JSON for authorization and input parameters:</p>
<pre><code class="language-JSON">{
    &quot;api_key&quot;: &quot;string, required for authorization&quot;,
    &quot;sensor_id&quot;: &quot;int, required&quot;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sensordata-api"><a class="header" href="#sensordata-api">SensorData API</a></h1>
<p>The SensorData API allows other services and users to access the SensorData data via its many endpoints.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
